<div class="loading-shade" *ngIf="loading">
  <mat-progress-spinner 
    [mode]="percentage >= 0 ? 'determinate' : 'indeterminate'"
    [value]="percentage"
    diameter="50"
    >
  </mat-progress-spinner>
</div>
<div *ngIf="form">
  <div class="cloudapp-actions">
    <button mat-flat-button color="secondary" [routerLink]="['']">{{'Cancel' | translate}}</button>
    <button mat-flat-button color="primary" [disabled]="form.errors!=null" (click)="update()">{{'Main.Update' | translate:{count: this.ids.length} }}</button>
  </div>
  <p>{{'Form.Intro' | translate}}</p>
  <div class="grid" *ngIf="form" [formGroup]="form">
    <div class="field-title">{{'Form.Fields.internal_description' | translate}}</div>
    <div>
      <mat-form-field>
        <mat-select value="NONE" data-action="internal_description" (selectionChange)="toggle($event)">
          <mat-option *ngFor="let action of [ 'none', 'clear', 'replace', 'append' ]" [value]="action.toUpperCase()">{{'Form.Actions.'+action | translate}}</mat-option>
        </mat-select>
      </mat-form-field>
    </div>
    <div>
      <mat-form-field>
        <mat-label>{{'Form.Fields.internal_description' | translate}}</mat-label>
        <textarea matInput 
        [formControl]="form.get('internal_description')"
        cdkTextareaAutosize
        cdkAutosizeMinRows="1"
        cdkAutosizeMaxRows="5"></textarea>
      </mat-form-field>  
    </div>
    <div class="field-title">{{'Form.Fields.proxy_enabled.value' | translate}}</div>
    <div>
      <mat-form-field>
        <mat-select value='NONE' data-action="proxy_enabled.value" (selectionChange)="toggle($event)">
          <mat-option *ngFor="let action of [ 'none', 'replace' ]" [value]="action.toUpperCase()">{{'Form.Actions.'+action | translate}}</mat-option>
        </mat-select>
      </mat-form-field>  
    </div>
    <div> 
      <mat-radio-group aria-label="Select an option" [formControl]="form.get('proxy_enabled.value')">
        <mat-radio-button *ngFor="let row of options.booleanYesNo" [value]="row.code">{{row.desc}}</mat-radio-button>
      </mat-radio-group>  
    </div>
    <div class="field-title">{{'Form.Fields.free.value' | translate}}</div>
    <div>
      <mat-form-field>
        <mat-select value='NONE' data-action="free.value" (selectionChange)="toggle($event)">
          <mat-option *ngFor="let action of [ 'none', 'replace' ]" [value]="action.toUpperCase()">{{'Form.Actions.'+action | translate}}</mat-option>
        </mat-select>
      </mat-form-field>  
    </div>
    <div> 
      <mat-radio-group aria-label="Select an option" [formControl]="form.get('free.value')">
        <mat-radio-button *ngFor="let row of options.isFree" [value]="row.code">{{row.desc}}</mat-radio-button>
      </mat-radio-group>  
    </div>
    <div class="field-title">{{'Form.Fields.proxy' | translate}}</div>
    <div>
      <mat-form-field>
        <mat-select value='NONE' data-action="proxy" (selectionChange)="toggle($event)">
          <mat-option *ngFor="let action of [ 'none', 'clear', 'replace' ]" [value]="action.toUpperCase()">{{'Form.Actions.'+action | translate}}</mat-option>
        </mat-select>
      </mat-form-field>  
    </div>
    <div> 
      <mat-form-field>
        <mat-placeholder>{{'SelectOne' | translate}}</mat-placeholder>
        <mat-select [formControl]="form.get('proxy')">
          <mat-option *ngFor="let proxy of options.proxies" [value]="proxy.code">{{proxy.code.concat(proxy.code ? ' (' + proxy.desc + ')' : '')}}</mat-option>
        </mat-select>
      </mat-form-field>  
    </div>  
    <div class="field-title">{{'Form.Fields.category' | translate}}</div>
    <div>
      <mat-form-field>
        <mat-select value='NONE' data-action="category" (selectionChange)="toggle($event)">
          <mat-option *ngFor="let action of [ 'none', 'clear', 'replace', 'append' ]" [value]="action.toUpperCase()">{{'Form.Actions.'+action | translate}}</mat-option>
        </mat-select>
      </mat-form-field>  
    </div>    
    <div>
      <mat-form-field>
        <mat-label>{{'Form.Fields.category' | translate}}</mat-label>
        <input matInput type="text" [formControl]="form.get('category')">
      </mat-form-field>  
    </div>
    <div class="field-title">{{'Form.Fields.access_type.value' | translate}}</div>
    <div>
      <mat-form-field>
        <mat-select value='NONE' data-action="access_type.value" (selectionChange)="toggle($event)">
          <mat-option *ngFor="let action of [ 'none', 'replace' ]" [value]="action.toUpperCase()">{{'Form.Actions.'+action | translate}}</mat-option>
        </mat-select>
      </mat-form-field>  
    </div>
    <div> 
      <mat-radio-group aria-label="Select an option" [formControl]="form.get('access_type.value')">
        <mat-radio-button *ngFor="let row of options.collectionAccessType" [value]="row.code">{{row.desc}}</mat-radio-button>
      </mat-radio-group>  
    </div>
    <div class="field-title">{{'Form.Fields.counter_platform.value' | translate}}</div>
    <div>
      <mat-form-field>
        <mat-select value='NONE' data-action="counter_platform.value" (selectionChange)="toggle($event)">
          <mat-option *ngFor="let action of [ 'none', 'replace' ]" [value]="action.toUpperCase()">{{'Form.Actions.'+action | translate}}</mat-option>
        </mat-select>
      </mat-form-field>  
    </div>
    <div> 
      <mat-form-field>
        <mat-placeholder>{{'SelectOne' | translate}}</mat-placeholder>
        <mat-select [formControl]="form.get('counter_platform.value')">
          <mat-option *ngFor="let row of options.counterPlatform" [value]="row.code">{{row.desc}}</mat-option>
        </mat-select>
      </mat-form-field>  
    </div>   
    <div class="field-title">{{'Form.Fields.license.value' | translate}}</div>
    <div>
      <mat-form-field>
        <mat-select value='NONE' data-action="license.value" (selectionChange)="toggle($event)">
          <mat-option *ngFor="let action of [ 'none', 'replace' ]" [value]="action.toUpperCase()">{{'Form.Actions.'+action | translate}}</mat-option>
        </mat-select>
      </mat-form-field>  
    </div>
    <div> 
      <mat-form-field>
        <mat-placeholder>{{'SelectOne' | translate}}</mat-placeholder>
        <mat-select [formControl]="form.get('license.value')">
          <mat-option *ngFor="let license of options.licenses" [value]="license.code">{{license.desc}}</mat-option>
        </mat-select>
      </mat-form-field>  
    </div>   
    <div class="field-title">{{'Form.Fields.activation_date' | translate}}</div>
    <div>
      <mat-form-field>
        <mat-select value='NONE' data-action="activation_date" (selectionChange)="toggle($event)">
          <mat-option *ngFor="let action of [ 'none', 'clear', 'replace' ]" [value]="action.toUpperCase()">{{'Form.Actions.'+action | translate}}</mat-option>
        </mat-select>
      </mat-form-field>  
    </div>    
    <div>
      <mat-form-field>
        <mat-label>{{'Form.Fields.activation_date' | translate}}</mat-label>
        <input matInput [matDatepicker]="activationPicker" [formControl]="form.get('activation_date')">
        <mat-datepicker-toggle matSuffix [for]="activationPicker"></mat-datepicker-toggle>
        <mat-datepicker #activationPicker></mat-datepicker>    
      </mat-form-field>  
    </div>
    <div class="field-title">{{'Form.Fields.expected_activation_date' | translate}}</div>
    <div>
      <mat-form-field>
        <mat-select value='NONE' data-action="expected_activation_date" (selectionChange)="toggle($event)">
          <mat-option *ngFor="let action of [ 'none', 'clear', 'replace' ]" [value]="action.toUpperCase()">{{'Form.Actions.'+action | translate}}</mat-option>
        </mat-select>
      </mat-form-field>  
    </div>    
    <div>
      <mat-form-field>
        <mat-label>{{'Form.Fields.expected_activation_date' | translate}}</mat-label>
        <input matInput [matDatepicker]="expectedPicker" [formControl]="form.get('expected_activation_date')">
        <mat-datepicker-toggle matSuffix [for]="expectedPicker"></mat-datepicker-toggle>
        <mat-datepicker #expectedPicker></mat-datepicker>    
      </mat-form-field>  
    </div>
  </div>
  <div *ngIf="form.errors" class="field-title">
    <ul>
      <li *ngFor="let field of form.errors.missingFields">
        <span class="alert alert-danger" [translateParams]="{field: 'Form.Fields.'+field | translate}" translate>Form.Validation.Required</span>
      </li>
    </ul>
  </div> 
</div>
<div *ngIf="results" class="results">
  <div>
    <p *ngIf="results.successCount>0" translate [translateParams]="{num: results.successCount}">Form.Results.Success</p>
    <p *ngIf="results.failureCount>0" translate [translateParams]="{num: results.failureCount}" style="color: red">Form.Results.Failure</p>
  </div>
  <button mat-flat-button routerLink="/" color="accent">{{'OK' | translate}}</button>
  <mat-expansion-panel >
    <mat-expansion-panel-header>
      <mat-panel-title>
        {{'Form.Results.Details' | translate}}
      </mat-panel-title>
    </mat-expansion-panel-header>
    <ul>
      <li *ngFor="let result of results.details">{{result.msg}}</li>
    </ul>
  </mat-expansion-panel>
</div>